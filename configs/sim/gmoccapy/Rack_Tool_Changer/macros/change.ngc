
o<change> sub

; we must execute this only in the milltask interpreter
; or preview will break, so test for '#<_task>' which is 1 for 
; the milltask interpreter and 0 in the UI's
O100 if [#<_task> EQ 0]
        (debug, Task ist Null)
O100     return [999]
O100 endif

; =======================================================================================================

(DEBUG, Aktuelles Werkzeug = #<_current_tool>)
(DEBUG, Aktueller Werkzeugplatz = #<_curr_pocket>)
(DEBUG, Neues Werkzeug = #<_selected_tool>)
(DEBUG, Neuer Werkzeugplatz = #<_selected_pocket>)

; =======================================================================================================

; First put the tool in its pocket
#<Y-Pos> = [[#<_ini[TOOLCHANGER]FIRST_TOOL_Y>] + [#<_current_pocket>] * [#<_ini[TOOLCHANGER]DIFF_RACK>] ]



#<Y-Pos> = [#<_ini[TOOLCHANGER]FIRST_TOOL_Y>] 
;#<Y-Pos> = [ [#<Y-Pos>] + [#<pocket>] * [#<_ini[TOOLCHANGER]DIFF_RACK>] ]

; Move over the first tool
G53 G0 Z[#<_ini[TOOLCHANGER]OVER_TOOL_Z>]
G53 G0 X[#<_ini[TOOLCHANGER]FIRST_TOOL_X>] Y[#<Y-Pos>]
G53 G0 Z[#<_ini[TOOLCHANGER]PICK_Z>]

; =======================================================================================================

; signal success be returning a value > 0:
o<change> endsub [1]

M2
